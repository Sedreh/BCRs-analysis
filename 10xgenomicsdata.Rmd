---
title: "10xgenomicsdata"
output: word_document
---

```{r}
library(dplyr)
library(tidyr)
```

```{r}
data1 = read.csv ('/media/sedreh/DC8C64618C643862/bioinformatics course/ITMO/semester2/Bcellsproject/third session/filterreddata.csv')
summary(data1)
```

```{r}
#Number of cells (As we have several copies of each barcode,we need to count just one copy of unique barcoe)

barcode_summary <- function(data1)
{
  number_of_cells <- data1 %>% 
    distinct(barcode) %>% 
    count()
  number_of_cells$n 
}
barcode_summary(data1)
```

```{r}
#look at to the quality of chains

count_table <- function(data1)
{
v_gene_and_j_gene <- filter(data1, v_gene != 'None' & j_gene != 'None')
v_gene_and_j_gene <- count(v_gene_and_j_gene)$n

no_v_gene_and_no_j_gene <- filter(data1, v_gene == 'None' & j_gene == 'None')
no_v_gene_and_no_j_gene <- count(no_v_gene_and_no_j_gene)$n

v_gene_or_j_gene <- filter(data1, v_gene != 'None' | j_gene != 'None')
v_gene_or_j_gene <- count(v_gene_or_j_gene)$n

stats <- data.frame(v_gene_and_j_gene, v_gene_or_j_gene, no_v_gene_and_no_j_gene)
stats
}
count_table(data1)
```

```{r}
#How many IGK,IGH, IGL and Multi we have in the data?
Summary <- function(data1)
{
  chain_summary <- group_by(data1, chain)
  chain_summary <- summarize(chain_summary, count=n()) 
  chain_summary
}
Summary (data1)
```

```{r}
#Number of copies of each cell

barcode_summary <- function(data1)
  {
  barcode_summary <- group_by(data1, barcode) 
  barcode_summary <- summarize(barcode_summary, count=n())
  barcode_summary
}
barcode_summary(data1)
```

```{r}
#show the number of occurance of each copy

barcode_summary <- function(data1)
  {
  barcode_summary <- group_by(data1, barcode) 
  barcode_summary <- summarize(barcode_summary, count=n())
  barcode_summary <- group_by(barcode_summary, count) 
  #barcode_summary <- summarize(barcode_summary, count_total=n())
  barcode_summary
}
result <- barcode_summary(data1)
result
```

```{r}
hist(result$count)
```

```{r}
#counts number of occurance of each chain type for every unique barcodehow 

occurance_of_each_chain <- function(data1)
{
  result <- data1 %>%
    group_by(barcode, chain) %>%
    filter(chain %in% c('IGK','IGH','IGL')) %>%
    summarize(count=n())
  result 
}
occurance_of_each_chain(data1)
```

```{r}
# I have all conditions here

occurance_of_each_chain <- function(data1)
  {
  result <- data1 %>%
    group_by(barcode, chain) %>%
    filter(chain %in% c('IGK','IGH','IGL')) %>%
    summarize(count=n())
  result <- unite(result, 'result_chain', count, chain, remove=F, sep='') 
  result <- summarize(result, type=paste(result_chain, collapse='_'), count=sum(count))
  result
}
occurance_of_each_chain(data1)
```

```{r}
# I added whichever condition that I want from data

Condition <- function (result)
  {
  
  many_conditions = c(
  '1IGL', '1IGH', '1IGK', '1IGH_1IGK_1IGL' , '1IGH_1IGL' , '1IGH_1IGK', '1IGH_2IGK', 'IGH_2IGL')
  result %>% 
  filter(type %in% many_conditions) %>% 
  group_by(type) %>% 
  summarise(total=n())
}
Condition(occurance_of_each_chain(data1))
```

